import os
import time
import datetime
import json

'''
Diccionario de contacto
=======================

data = {
        contactos: [
                      {
                      'nombre': None,
                      'apellido': None,
                      'telefono': {
                                  'fijo': None,
                                  'movil': None,
                                  },
                      'email': {
                                'personal': None,
                                'trabajo': None, 
                               }
                      'fecha_nac': None,
                     },
                ]
       }
'''

class Contacto:
    def __init__(self, nombre = "", apellido = "", t_fijo = "", t_movil = "", email_per = "", email_lab = "", fecha_nac = "", edad = ""):
        self.nombre = nombre
        self.apellido = apellido
        self.t_fijo = t_fijo
        self.t_movil = t_movil
        self.email_per = email_per
        self.email_lab = email_lab
        self.fecha_nac = fecha_nac
        self.edad = self.__set_edad()
    
    @property
    def nombre(self):
        return self.__nombre
    
    @nombre.setter
    def nombre(self, val):
        if isinstance(val, str):
            self.__nombre = val
        else:
            raise TypeError("El campo 'nombre' debe ser un 'str'")
            
    @property
    def apellido(self):
        return self.__apellido
    
    @apellido.setter
    def apellido(self, val):
        if isinstance(val, str):
            self.__apellido = val
        else:
            raise TypeError("El campo 'apellido' debe ser un 'str'")
    
    @property
    def t_fijo(self):
        return self.__t_fijo
    
    @t_fijo.setter
    def t_fijo(self, val):
        if isinstance(val, str):
            self.__t_fijo = val
        else:
            raise TypeError("El campo 't_fijo' debe ser un 'str'")
    
    @property
    def t_movil(self):
        return self.__t_movil
    
    @t_movil.setter
    def t_movil(self, val):
        if isinstance(val, str):
            self.__t_movil = val
        else:
            raise TypeError("El campo 't_movil' debe ser un 'str'")
            
    @property
    def email_per(self):
        return self.__email_per
    
    @email_per.setter
    def email_per(self, val):
        if isinstance(val, str):
            self.__email_per = val
        else:
            raise TypeError("El campo 'email_per' debe ser un 'str'")
            
    @property
    def email_lab(self):
        return self.__email_lab
    
    @email_lab.setter
    def email_lab(self, val):
        if isinstance(val, str):
            self.__email_lab = val
        else:
            raise TypeError("El campo 'email_lab' debe ser un 'str'")
    
    @property
    def fecha_nac(self):
        return self.__fecha_nac
    
    @fecha_nac.setter
    def fecha_nac(self, val):
        if isinstance(val, str):
            self.__fecha_nac = val
        else:
            raise TypeError("El campo 'fecha_nac' debe ser un 'str'")
            
    def __set_edad(self):
        
        fecha = datetime.datetime.now()
        anio_act = fecha.year
        mes_act = fecha.month
        dia_act = fecha.day
        dia_nac, mes_nac, anio_nac  = self.fecha_nac.split('/')
        
        if (int(mes_nac) >= int(mes_act)) and (int(dia_nac) >= int(dia_act)):
            return str(int(anio_act) - int(anio_nac)) 
        
        else:
            return str(int(anio_act) - int(anio_nac) -1) 
        
    def __repr__(self):
        str_out = "Contacto:\n"
        str_out += "\tNombre: {}\n".format(self.nombre)
        str_out += "\tApellido: {}\n".format(self.apellido)
        str_out += "\tTelefono Fijo: {}\n".format(self.t_fijo)
        str_out += "\tTelefono Movil: {}\n".format(self.t_movil)
        str_out += "\tEmail Personal: {}\n".format(self.email_per)
        str_out += "\tEmail Laboral: {}\n".format(self.email_lab)
        str_out += "\tFecha de Nacimiento: {}\n".format(self.fecha_nac)
        str_out += "\tEdad: {}\n".format(self.edad)
        return str_out
    

def clear_screen():
    _ = os.system('cls')
    return None


def show_menu():
    clear_screen()
    print("\nAGENDA DE CONTACTOS")
    print("====================")
    print("[1] Agregar contacto")
    print("[2] Mostrar contactos")
    print("[3] Ver detalle de contactos")
    print("[4] Editar contacto")
    print("[5] Borrar contacto")
    print("[0] Salir")
    opc = int(input("\nOpcion: "))
    
    return opc


def read_file(file):
    '''
    Esta funcion lee un archivo json con la informacion de los contactos
    registrados y retorna una lista con objetos Contacto
    '''
    
    out = []
    
    with open(file) as json_file:
        data = json.load(json_file)
    
    for cont in data['contactos']:
        out.append(Contacto(str(cont['nombre']),str(cont['apellido']),str(cont['telefono']['fijo']),str(cont['telefono']['movil']),
                            str(cont['email']['personal']),str(cont['email']['trabajo']),str(cont['fecha_nac'])))
        
    return out


def write_file(file, contact_list):
    '''
    Esta funcion crear un diccionario con la informacion de la lista de 
    contactos (con objetos Contacto) y escribe un archivo json con la
    informacion del diccionario
    '''
    data = dict(contactos=[])
    
    for i in contact_list:
        data['contactos'].append({'nombre': i.nombre,
                            'apellido': i.apellido,
                            'edad': i.edad,
                            'telefono':{'fijo':i.t_fijo,'movil':i.t_movil},
                            'email':{'personal':i.email_per,'movil':i.email_lab},
                            'fecha_nac':i.fecha_nac
                            })
    


def find_contact(contact_list, name_str):
    '''
    Esta funcion busca en una lista de contactos (con objetos Contactos)
    un contacto especificado por nombre
    '''
    found = False
    
    for con in contact_list:
        if name_str.lower() in con.nombre.lower():
            found = True
            return con
            
        
        
    if not found:
        print("No se han encontrado contactos con el nombre anterior")
            


def edit_contact(contact_obj):
    '''
    Funcion que cambia los cambios de un objeto Contacto
    '''
    pass


def delete_contact(contact_list):
    '''
    Funcion que elimina un objeto Contacto de una lista de objetos Contactos
    '''
    pass


def show_contact(contact):
    '''
    Funcion que muestra los detalles de un objeto Contacto <print(obj)>
    '''
    print(contact)


def list_contact(contact_list):
    '''
    Funcion que muestra un listado de contactos numerados con la informacion
    de nombre y apellido en ordenado de forma alfabetica
    '''
    
    prov = []
    
    for person in contact_list:
        nombre = person.nombre + " " + person.apellido
        prov.append(nombre)
        prov.sort()
        
    print("Lista de Contactos:")
    print("===============================")
     
    for idx, element in enumerate(prov,1):  
        print(f"{idx:2}. {element}")
        

def salir():
    '''
    Funcion que pide al usuario confirmacion para salir. Retorrna un boolean.
    '''
    y_n = input("\nSeguro desea salir? [Si/No]: ")
    
    if y_n[0].upper() == "S":
        return True
    else:
        return False

def main():
    
    lista = read_file('contactos(1).json')
    
    while True:
        opc = show_menu()
        if opc in [1, 2, 3, 4, 5]:
            print("\nSelecciono la opcion", opc)
            time.sleep(1)
            
            if opc is 2:
                list_contact(lista)
                
            elif opc is 3:
                search = input("Ingrese el nombre del contacto a buscar: ")
                usuario = find_contact(lista,search)
                show_contact(usuario)
                
        elif opc == 0:
            if salir():
                break
        else:
            print("\nLa opcion ingresada no es valida")


if __name__ == '__main__':
    main()

 
